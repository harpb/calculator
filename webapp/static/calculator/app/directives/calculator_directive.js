// Generated by CoffeeScript 1.8.0
(function() {
  var app;

  app = angular.module('app');

  app.directive('calculator', function() {
    return {
      scope: {},
      templateUrl: 'app/directives/calculator.html',
      controller: function($scope, $http) {
        var EDIT, ERROR, PRESENTATION;
        EDIT = 'edit';
        ERROR = 'error';
        PRESENTATION = 'presentation';
        $scope.expression = '';
        $scope.isEvaluating = false;
        $scope.resetText = 'AC';
        $scope.editMode = function() {
          if ($scope.mode === EDIT) {
            return;
          }
          if ($scope.mode === PRESENTATION) {
            $scope.result = $scope.expression;
          }
          $scope.resetText = 'CE';
          $scope.expression = '';
          return $scope.mode = EDIT;
        };
        $scope.presentationMode = function(answer) {
          console.debug('presentationMode', arguments);
          if ($scope.mode === PRESENTATION) {
            return;
          }
          $scope.resetText = 'AC';
          $scope.result = $scope.expression;
          $scope.expression = answer;
          return $scope.mode = PRESENTATION;
        };
        $scope.errorMode = function() {
          if ($scope.mode === ERROR) {
            return;
          }
          $scope.resetText = 'AC';
          $scope.mode = ERROR;
          $scope.result = $scope.expression;
          return $scope.expression = 'Error';
        };
        $scope.digit = function(digit) {
          $scope.editMode();
          return $scope.expression += digit;
        };
        $scope.operator = function(operator) {
          var prefix;
          $scope.editMode();
          prefix = operator === '%' || operator === '(' || operator === ')' ? '' : ' ';
          return $scope.expression += prefix + operator;
        };
        $scope.reset = function() {
          $scope.editMode();
          return $scope.expression = '';
        };
        $scope.evaluate = function() {
          var params, request;
          $scope.isEvaluating = true;
          params = {
            expression: $scope.expression
          };
          return request = $http.get('/calculator/evaluate/', {
            params: params
          }).success(function(data, status, headers, config) {
            $scope.isEvaluating = false;
            return $scope.presentationMode(data.answer);
          }).error(function(data, status, headers, config) {
            $scope.isEvaluating = false;
            return $scope.errorMode();
          });
        };
        return $scope.editMode();
      }
    };
  });

}).call(this);
